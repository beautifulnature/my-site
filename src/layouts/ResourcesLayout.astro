---
import '../styles/global.css';
import DocsTocScript from '../components/DocsTocScript.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import GoToTopButton from '../components/GoToTopButton.astro';
import ResourceIcons from '../components/ResourceIcons.astro';
import { RESOURCE_NAV_ITEMS, SIDEBAR_SECTIONS } from '../utils/navigation';
import { SITE_CONTENT } from '../utils/siteContent';

const {
  title = 'Resources',
  description = '',
  descriptionClass = '',
  currentPath = '',
} = Astro.props;

const linkBase =
  'px-3 py-1 rounded-full border border-slate-700 bg-white hover:border-[var(--scheme-accent)]';
const linkActive =
  'px-3 py-1 rounded-full border border-sky-500 bg-[var(--scheme-accent)] text-white';
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
  </head>
  <body class="scheme-default">
    <Header />
    <div class="flex pt-16">
      <!-- LEFT NAV -->
      <aside
        id="sidebar"
        class="w-64 border-r border-slate-800 p-6 md:block sidebar-hidden"
      >
        <h2>{SITE_CONTENT.sidebarHeading}</h2>

        {SIDEBAR_SECTIONS.map((section) => (
          <div class="mb-6">
            {section.heading && (
              <h3 class="h3-section-label">
                {section.heading}
              </h3>
            )}
            <ul class="space-y-1">
              {section.links.map((link) => (
                <li><a href={link.href} class="hover:text-white">{link.label}</a></li>
              ))}
            </ul>
          </div>
        ))}
      </aside>

      <!-- MAIN CONTENT -->
      <main class="flex-1">
        <div class="layout-container py-8">
          {title && (
            <header class="mb-8">
              <h1 class="h1-page-title mb-2" data-aos="fade-up" data-aos-duration="1000" data-aos-easing="ease-out-expo">{title}</h1>

              <div>
                {description && (
                  <p class={`${descriptionClass}`} set:html={description}></p>
                )}
              </div>

              <nav class="mt-4 flex gap-3">
                {RESOURCE_NAV_ITEMS.map((item) => (
                  <a href={item.href} class={currentPath === item.href ? linkActive : linkBase} aria-label={item.label}>
                    <span class={`resource-nav-icon ${currentPath === item.href ? 'resource-nav-icon-active' : 'resource-nav-icon-inactive'}`}>
                      <ResourceIcons name={item.iconName} size={20} color={currentPath === item.href ? 'white' : 'black'} />
                    </span>
                  </a>
                ))}
              </nav>
            </header>
          )}

          <slot />
        </div>
      </main>
    </div>

    <DocsTocScript enableToc={false} />
    <script is:inline>
      (() => {
        if (typeof window === "undefined") return;

        const animatedElements = document.querySelectorAll("[data-aos]");
        if (!animatedElements.length) return;

        const applyTimingFromData = (element) => {
          const duration = element.getAttribute("data-aos-duration");
          const delay = element.getAttribute("data-aos-delay");
          const easing = element.getAttribute("data-aos-easing");

          if (duration) element.style.transitionDuration = `${duration}ms`;
          if (delay) element.style.transitionDelay = `${delay}ms`;
          if (easing === "ease-out-expo") {
            element.style.transitionTimingFunction = "cubic-bezier(0.19, 1, 0.22, 1)";
          }
        };

        animatedElements.forEach((element) => {
          element.classList.add("aos-init");
          applyTimingFromData(element);
        });

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (!entry.isIntersecting) return;
              entry.target.classList.add("aos-animate");
              observer.unobserve(entry.target);
            });
          },
          {
            threshold: 0.15,
            rootMargin: "0px 0px -8% 0px",
          },
        );

        animatedElements.forEach((element) => observer.observe(element));
      })();
    </script>
    <GoToTopButton />
    <Footer />
  </body>
</html>