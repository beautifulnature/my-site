---
import '../styles/global.css';
import DocsTocScript from '../components/DocsTocScript.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import GoToTopButton from '../components/GoToTopButton.astro';
import ResourceIcons from '../components/ResourceIcons.astro';
import { RESOURCE_NAV_ITEMS, SIDEBAR_SECTIONS } from '../utils/navigation';
import { SITE_CONTENT } from '../utils/siteContent';

const {
  title = 'Resources',
  description = '',
  descriptionClass = '',
  currentPath = '',
} = Astro.props;

const linkBase = 'resource-tag-link';
const linkActive = 'resource-tag-link resource-tag-link--active';
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
  </head>
  <body class="scheme-default">
    <Header />
    <div class="flex">
      <!-- LEFT NAV -->
      <aside
        id="sidebar"
        class="w-64 border-r border-slate-800 p-6 vp7:block sidebar-hidden"
      >
        <h2>{SITE_CONTENT.sidebarHeading}</h2>

        {SIDEBAR_SECTIONS.map((section) => (
          <div class="mb-6">
            {section.heading && (
              <h3 class="h3-section-label">
                {section.heading}
              </h3>
            )}
            <ul class="space-y-1">
              {section.links.map((link) => (
                <li><a href={link.href} class="hover:text-white">{link.label}</a></li>
              ))}
            </ul>
          </div>
        ))}
      </aside>

      <!-- MAIN CONTENT -->
      <main class="flex-1">
        {title && (
          <section class="layout bound-x py-3 md:py-4 border-b border-solid prop-border scheme-default">
            <div class="c-hero scheme-default">
              <div class="c-hero__content">
                <h1 class="c-title c-hero__title aos-init aos-animate" data-aos="fade-up" data-aos-duration="1000" data-aos-easing="ease-out-expo">{title}</h1>
              </div>
            </div>
          </section>
        )}

        {title && (
          <section class="layout bound-x py-3 md:py-4 border-b border-solid prop-border scheme-default">
            <div class="layout-container layout-container--flush">
              <header>
                <div>
                  {description && (
                    <p class={`${descriptionClass}`} set:html={description}></p>
                  )}
                </div>

                <nav class="mt-3 flex gap-3 pt-2 pr-3 pb-2">
                  {RESOURCE_NAV_ITEMS.map((item) => (
                    <a href={item.href} class={currentPath === item.href ? linkActive : linkBase} aria-label={item.label}>
                      <span class={`resource-nav-icon ${currentPath === item.href ? 'resource-nav-icon-active' : 'resource-nav-icon-inactive'}`}>
                        <ResourceIcons name={item.iconName} size={20} color={currentPath === item.href ? 'hsl(var(--color-neutral-100)/1)' : 'var(--scheme-title)'} />
                      </span>
                    </a>
                  ))}
                </nav>
              </header>
            </div>
          </section>
        )}

        <section class="layout bound-x">
          <div class="grid grid-cols-12">
            <slot />
          </div>
        </section>
      </main>
    </div>

    <DocsTocScript enableToc={false} />
    <script is:inline>
      (() => {
        if (typeof window === "undefined") return;

        const animatedElements = document.querySelectorAll("[data-aos]");
        if (!animatedElements.length) return;

        const applyTimingFromData = (element) => {
          const duration = element.getAttribute("data-aos-duration");
          const delay = element.getAttribute("data-aos-delay");
          const easing = element.getAttribute("data-aos-easing");

          if (duration) element.style.transitionDuration = `${duration}ms`;
          if (delay) element.style.transitionDelay = `${delay}ms`;
          if (easing === "ease-out-expo") {
            element.style.transitionTimingFunction = "cubic-bezier(0.19, 1, 0.22, 1)";
          }
        };

        animatedElements.forEach((element) => {
          element.classList.add("aos-init");
          applyTimingFromData(element);
        });

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (!entry.isIntersecting) return;
              entry.target.classList.add("aos-animate");
              observer.unobserve(entry.target);
            });
          },
          {
            threshold: 0.15,
            rootMargin: "0px 0px -8% 0px",
          },
        );

        animatedElements.forEach((element) => observer.observe(element));
      })();
    </script>
    <GoToTopButton />
    <Footer />
  </body>
</html>