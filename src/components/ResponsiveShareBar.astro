---
import ResourceIcons from "./ResourceIcons.astro";
import { COLOR_PRIMARY, COLOR_WHITE } from '../utils/colors';

const { url, title } = Astro.props;

// Color constants for easy reuse and updates
const SHARE_BG_HOVER = COLOR_PRIMARY;
const SHARE_BORDER_HOVER = COLOR_PRIMARY;
const SHARE_TEXT_HOVER = COLOR_WHITE;
const SHARE_BORDER = 'border-slate-700';

const pageUrl = url;
const tweetText = encodeURIComponent(title);

const twitterShare = `https://twitter.com/intent/tweet?url=${encodeURIComponent(
  pageUrl,
)}&text=${tweetText}`;
const linkedinShare = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(
  pageUrl,
)}`;
const hackerNewsShare = `https://news.ycombinator.com/submitlink?u=${encodeURIComponent(
  pageUrl,
)}&t=${tweetText}`;
---

<!-- Desktop: Show all share links inline -->
<div class="hidden vp9:flex flex-wrap items-center gap-2">
  <span class="flex h-8 w-8 items-center justify-center rounded-full border border-slate-700 text-black">
    <ResourceIcons name="share" size={16} color="black" />
  </span>

  <a
    href={twitterShare}
    target="_blank"
    rel="noreferrer"
    class={`flex items-center justify-center rounded-full border ${SHARE_BORDER} p-2 hover:border-[${SHARE_BORDER_HOVER}] hover:bg-[${SHARE_BG_HOVER}] hover:text-${SHARE_TEXT_HOVER} transition-colors`}
    aria-label="Share on Twitter / X"
  >
    <ResourceIcons name="twitter" size={16} color="currentColor" />
  </a>

  <a
    href={linkedinShare}
    target="_blank"
    rel="noreferrer"
    class={`flex items-center justify-center rounded-full border ${SHARE_BORDER} p-2 hover:bg-[${SHARE_BG_HOVER}] hover:border-[${SHARE_BORDER_HOVER}] hover:text-${SHARE_TEXT_HOVER} transition-colors`}
    aria-label="Share on LinkedIn"
  >
    <ResourceIcons name="linkedin" size={16} color="currentColor" />
  </a>

  <a
    href={hackerNewsShare}
    target="_blank"
    rel="noreferrer"
    class={`flex items-center justify-center rounded-full border ${SHARE_BORDER} p-2 hover:bg-[${SHARE_BG_HOVER}] hover:border-[${SHARE_BORDER_HOVER}] hover:text-${SHARE_TEXT_HOVER} transition-colors`}
    aria-label="Share on Hacker News"
  >
    <ResourceIcons name="hackernews" size={16} color="currentColor" />
  </a>
</div>

<!-- Mobile: Show only share button that opens modal -->
<div class="vp9:hidden">
  <button
    id="mobile-share-btn"
    class="flex h-8 w-8 items-center justify-center rounded-full border border-slate-700 text-black hover:bg-[var(--scheme-accent)] hover:text-white hover:border-[var(--scheme-accent)] transition-colors"
    aria-label="Share"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      class="h-4 w-4"
      fill="none"
      stroke="currentColor"
      stroke-width="1.8"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <circle cx="18" cy="5" r="3" />
      <circle cx="6" cy="12" r="3" />
      <circle cx="18" cy="19" r="3" />
      <path d="M8.59 11.51 15.42 7.49" />
      <path d="M8.59 12.49 15.42 16.51" />
    </svg>
  </button>
</div>

<!-- Share modal (mobile only, shown at top of page) -->
<div
  id="share-modal"
  class="fixed left-0 right-0 top-0 z-50 hidden p-4 pt-16 vp9:hidden"
>
  <div class="layout-content-2xl">
    <div class="mb-4 flex items-center justify-end">
          <button
            id="close-share-modal"
            class="text-black group"
            aria-label="Close"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              class="h-5 w-5 group-hover:stroke-[var(--scheme-accent)]"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
    </div>

    <div class="flex flex-wrap gap-3">
      <a
        href={twitterShare}
        target="_blank"
        rel="noreferrer"
        class={`inline-flex items-center gap-2 rounded-full border ${SHARE_BORDER} px-4 py-2 text-sm hover:border-[${SHARE_BORDER_HOVER}] hover:bg-[${SHARE_BG_HOVER}] hover:text-${SHARE_TEXT_HOVER} transition-colors`}
        aria-label="Share on Twitter / X"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          class="h-4 w-4"
          fill="currentColor"
        >
          <path d="M18.244 3.515h3.308l-7.227 8.26 8.502 11.21H16.17l-4.927-6.437L5.55 22.985H2.24l7.73-8.85L1.79 3.515h6.828l4.453 5.836 5.173-5.836Z" />
        </svg>
      </a>

      <a
        href={linkedinShare}
        target="_blank"
        rel="noreferrer"
        class={`inline-flex items-center gap-2 rounded-full border ${SHARE_BORDER} px-4 py-2 text-sm hover:bg-[${SHARE_BG_HOVER}] hover:border-[${SHARE_BORDER_HOVER}] hover:text-${SHARE_TEXT_HOVER} transition-colors`}
        aria-label="Share on LinkedIn"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          class="h-4 w-4"
          fill="currentColor"
        >
          <path d="M4.983 3.5C4.983 4.88 3.88 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.983 2.12 4.983 3.5zM.29 8.25h4.42V24H.29V8.25zm7.34 0h4.24v2.13h.06c.59-1.12 2.03-2.3 4.18-2.3 4.47 0 5.29 2.94 5.29 6.76V24h-4.42v-7.39c0-1.76-.03-4.03-2.46-4.03-2.47 0-2.85 1.93-2.85 3.91V24H7.63V8.25z" />
        </svg>
      </a>

      <a
        href={hackerNewsShare}
        target="_blank"
        rel="noreferrer"
        class={`inline-flex items-center gap-2 rounded-full border ${SHARE_BORDER} px-4 py-2 text-sm hover:bg-[${SHARE_BG_HOVER}] hover:border-[${SHARE_BORDER_HOVER}] hover:text-${SHARE_TEXT_HOVER} transition-colors`}
        aria-label="Share on Hacker News"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          class="h-4 w-4"
          fill="currentColor"
        >
          <path d="M4 4h16v16H4V4zm8.707 7.293 2.586-4.586h-1.732L12 10.382 10.439 6.707H8.707l2.586 4.586V16h1.414v-4.707z" />
        </svg>
      </a>
    </div>
  </div>
</div>

<script>
  const shareBtn = document.getElementById('mobile-share-btn');
  const shareModal = document.getElementById('share-modal');
  const closeBtn = document.getElementById('close-share-modal');

  if (shareBtn && shareModal && closeBtn) {
    shareBtn.addEventListener('click', () => {
      shareModal.classList.toggle('hidden');
    });

    closeBtn.addEventListener('click', () => {
      shareModal.classList.add('hidden');
    });

    // Close modal when clicking outside
    shareModal.addEventListener('click', (e) => {
      if (e.target === shareModal) {
        shareModal.classList.add('hidden');
      }
    });
  }
</script>
